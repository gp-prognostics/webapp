<html>
  <head>
    <title>GP Prognostics - Redirection vers Discord</title>
    <meta charset="utf-8" />
    <style>
      body {
        background-color: #2c2f33;
        color: #fff;
        font-family: "Open Sans", sans-serif;
        font-size: 16px;
        line-height: 1.5;
        margin: 0;
        padding: 0;
        text-align: center;
      }

      h1 {
        font-size: 2em;
        font-weight: 400;
        margin: 0;
      }

      p {
        margin: 0;
      }
    </style>
  </head>
  <body>
    <h1>Redirection vers Discord...</h1>
    <p>Vous allez être redirigé vers Discord pour vous connecter.</p>
    <script>
      var url = new URL(window.location.href);
      var code = url.searchParams.get("code");
      if (code != null) {
        const url =
          "https://beta.gp-prognostics.fr/api/discord/login/?code=" + code;

        fetch(url)
          .then((response) => {
            return response.json();
          })
          .then((data) => {
            if (data.status === "success") {
              localStorage.setItem("token", data.token);
              window.location.href = window.location.origin;
            } else {
              window.location.href = window.location.origin + "/login/";
            }
          });
      } else {
        window.location.href =
          "https://discord.com/api/oauth2/authorize?client_id=1111955711665127535&redirect_uri=https%3A%2F%2Fbeta.gp-prognostics.fr%2Flogin%2F&response_type=code&scope=identify";
      }
    </script>
  </body>
</html>
